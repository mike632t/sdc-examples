/*
 * sdc-spigot.c - Example program for SDCC.
 * 
 * A  spigot  algorithm  for  the  digits of  pi,  Stanley  Rabinowitz  and 
 * Stan Wagon,  Amer.Math.Monthly,  March 1995, 195-203 with bug  fixes  by
 * C. Haenel.
 * 
 * The  number of digits that can be computed is limited by the size of the
 * TPA and user's paitence!  This program can compute the first 7660 digits
 * of Pi (the maximum number of digits that can be stored in a CP/M  system
 * where the top of ther TPA is at 0xDC00) in aproximatly 248.12 hours!
 * 
 * https://stackoverflow.com/questions/4084571
 * 
 * 314159265358979323846264338327950288419716939937510582097494459230781640
 * 628620899862803482534211706798214808651328230664709384460955058223172535
 * 940812848111745028410270193852110555964462294895493038196442881097566593
 * 344612847564823378678316527120190914564856692346034861045432664821339360
 * 726024914127372458700660631558817488152092096282925409171536436789259036
 * 001133053054882046652138414695194151160943305727036575959195309218611738
 * 193261179310511854807446237996274956735188575272489122793818301194912983
 * 367336244065664308602139494639522473719070217986094370277053921717629317
 * 675238467481846766940513200056812714526356082778577134275778960917363717
 * 872146844090122495343014654958537105079227968925892354201995611212902196
 * 086403441815981362977477130996051870721134999999837297804995105973173281
 * 609631859502445945534690830264252230825334468503526193118817101000313783
 * 875288658753320838142061717766914730359825349042875546873115956286388235
 * 378759375195778185778053217122680661300192787661119590921642019893809525
 * 720106548586327886593615338182796823030195203530185296899577362259941389
 * 124972177528347913151557485724245415069595082953311686172785588907509838
 * 175463746493931925506040092770167113900984882401285836160356370766010471
 * 018194295559619894676783744944825537977472684710404753464620804668425906
 * 949129331367702898915210475216205696602405803815019351125338243003558764
 * 024749647326391419927260426992279678235478163600934172164121992458631503
 * 028618297455570674983850549458858692699569092721079750930295532116534498
 * 720275596023648066549911988183479775356636980742654252786255181841757467
 * 289097777279380008164706001614524919217321721477235014144197356854816136
 * 115735255213347574184946843852332390739414333454776241686251898356948556
 * 209921922218427255025425688767179049460165346680498862723279178608578438
 * 382796797668145410095388378636095068006422512520511739298489608412848862
 * 694560424196528502221066118630674427862203919494504712371378696095636437
 * 191728746776465757396241389086583264599581339047802759009946576407895126
 * 946839835259570982582262052248940772671947826848260147699090264013639443
 * 745530506820349625245174939965143142980919065925093722169646151570985838
 * 741059788595977297549893016175392846813826868386894277415599185592524595
 * 395943104997252468084598727364469584865383673622262609912460805124388439
 * 045124413654976278079771569143599770012961608944169486855584840635342207
 * 222582848864815845602850601684273945226746767889525213852254995466672782
 * 398645659611635488623057745649803559363456817432411251507606947945109659
 * 609402522887971089314566913686722874894056010150330861792868092087476091
 * 782493858900971490967598526136554978189312978482168299894872265880485756
 * 401427047755513237964145152374623436454285844479526586782105114135473573
 * 952311342716610213596953623144295248493718711014576540359027993440374200
 * 731057853906219838744780847848968332144571386875194350643021845319104848
 * 100537061468067491927819119793995206141966342875444064374512371819217999
 * 839101591956181467514269123974894090718649423196156794520809514655022523
 * 160388193014209376213785595663893778708303906979207734672218256259966150
 * 142150306803844773454920260541466592520149744285073251866600213243408819
 * 071048633173464965145390579626856100550810665879699816357473638405257145
 * 910289706414011097120628043903975951567715770042033786993600723055876317
 * 635942187312514712053292819182618612586732157919841484882916447060957527
 * 069572209175671167229109816909152801735067127485832228718352093539657251
 * 210835791513698820914442100675103346711031412671113699086585163983150197
 * 016515116851714376576183515565088490998985998238734552833163550764791853
 * 589322618548963213293308985706420467525907091548141654985946163718027098
 * 199430992448895757128289059232332609729971208443357326548938239119325974
 * 636673058360414281388303203824903758985243744170291327656180937734440307
 * 074692112019130203303801976211011004492932151608424448596376698389522868
 * 478312355265821314495768572624334418930396864262434107732269780280731891
 * 544110104468232527162010526522721116603966655730925471105578537634668206
 * 531098965269186205647693125705863566201855810072936065987648611791045334
 * 885034611365768675324944166803962657978771855608455296541266540853061434
 * 443185867697514566140680070023787765913440171274947042056223053899456131
 * 407112700040785473326993908145466464588079727082668306343285878569830523
 * 580893306575740679545716377525420211495576158140025012622859413021647155
 * 097925923099079654737612551765675135751782966645477917450112996148903046
 * 399471329621073404375189573596145890193897131117904297828564750320319869
 * 151402870808599048010941214722131794764777262241425485454033215718530614
 * 228813758504306332175182979866223717215916077166925474873898665494945011
 * 465406284336639379003976926567214638530673609657120918076383271664162748
 * 888007869256029022847210403172118608204190004229661711963779213375751149
 * 595015660496318629472654736425230817703675159067350235072835405670403867
 * 435136222247715891504953098444893330963408780769325993978054193414473774
 * 418426312986080998886874132604721569516239658645730216315981931951673538
 * 129741677294786724229246543668009806769282382806899640048243540370141631
 * 496589794092432378969070697794223625082216889573837986230015937764716512
 * 289357860158816175578297352334460428151262720373431465319777741603199066
 * 554187639792933441952154134189948544473456738316249934191318148092777710
 * 386387734317720754565453220777092120190516609628049092636019759882816133
 * 231666365286193266863360627356763035447762803504507772355471058595487027
 * 908143562401451718062464362679456127531813407833033625423278394497538243
 * 720583531147711992606381334677687969597030983391307710987040859133746414
 * 428227726346594704745878477872019277152807317679077071572134447306057007
 * 334924369311383504931631284042512192565179806941135280131470130478164378
 * 851852909285452011658393419656213491434159562586586557055269049652098580
 * 338507224264829397285847831630577775606888764462482468579260395352773480
 * 304802900587607582510474709164396136267604492562742042083208566119062545
 * 433721315359584506877246029016187667952406163425225771954291629919306455
 * 377991403734043287526288896399587947572917464263574552540790914513571113
 * 694109119393251910760208252026187985318877058429725916778131496990090192
 * 116971737278476847268608490033770242429165130050051683233643503895170298
 * 939223345172201381280696501178440874519601212285993716231301711444846409
 * 038906449544400619869075485160263275052983491874078668088183385102283345
 * 085048608250393021332197155184306354550076682829493041377655279397517546
 * 139539846833936383047461199665385815384205685338621867252334028308711232
 * 827892125077126294632295639898989358211674562701021835646220134967151881
 * 909730381198004973407239610368540664319395097901906996395524530054505806
 * 855019567302292191393391856803449039820595510022635353619204199474553859
 * 381023439554495977837790237421617271117236434354394782218185286240851400
 * 666044332588856986705431547069657474585503323233421073015459405165537906
 * 866273337995851156257843229882737231989875714159578111963583300594087306
 * 812160287649628674460477464915995054973742562690104903778198683593814657
 * 412680492564879855614537234786733039046883834363465537949864192705638729
 * 317487233208376011230299113679386270894387993620162951541337142489283072
 * 201269014754668476535761647737946752004907571555278196536213239264061601
 * 363581559074220202031872776052772190055614842555187925303435139844253223
 * 415762336106425063904975008656271095359194658975141310348227693062474353
 * 632569160781547818115284366795706110861533150445212747392454494542368288
 * 606134084148637767009612071512491404302725386076482363414334623518975766
 * 452164137679690314950191085759844239198629164219399490723623464684411739
 * 4032659184044378051333894525
 * 
 */

#include <stdio.h>

#define N 7660 /* Max 7660 if CCP starts at 0xDC00 */
#define LEN (10L * N) / 3 + 1 /* Chain length. */

unsigned j, predigit, nines, a[LEN];
long x, q, k, len, i;

void main()
{
   for(j=N; j; ) 
   {
      q = 0;
      k = LEN+LEN-1;

      for(i=LEN; i; --i) 
      {
         x = (j == N ? 20 : 10L*a[i-1]) + q*i;
         q = x / k;
         a[i-1] = (unsigned)(x-q*k);
         k -= 2;
      }

      k = x % 10;
      if (k==9)
         ++nines;
      else 
      {
         if (j)
         {
            --j;
            printf("%ld", predigit+x/10);
         }

         for(; nines; --nines)
         {
            if (j) --j, printf(x >= 10 ? "0" : "9");
         }
         predigit = (unsigned)k;
      }
   }
   printf("\n");
}
